<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
    <style>
      :root {
        --radar-crop-amount: 250px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 10px;
        color: #333;
      }

      .container {
        max-width: 500px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        color: white;
        padding: 20px 0;
      }

      h1 {
        font-size: 28px;
        margin-bottom: 5px;
      }

      .location-info {
        font-size: 14px;
        opacity: 0.9;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: white;
        font-size: 18px;
      }

      .error {
        background: #ff6b6b;
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        text-align: center;
      }

      .current-weather {
        text-align: center;
      }

      .temp-display {
        font-size: 72px;
        font-weight: bold;
        color: #667eea;
        margin: 10px 0;
      }

      .weather-description {
        font-size: 24px;
        color: #666;
        margin-bottom: 20px;
      }

      .weather-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
      }

      .detail-item {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .detail-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        margin-bottom: 5px;
      }

      .detail-value {
        font-size: 20px;
        font-weight: bold;
        color: #333;
      }

      .section-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
      }

      .hourly-forecast {
        display: flex;
        overflow-x: auto;
        gap: 10px;
        padding-bottom: 10px;
      }

      .hourly-item {
        min-width: 80px;
        text-align: center;
        padding: 15px 10px;
        background: #f8f9fa;
        border-radius: 10px;
        flex-shrink: 0;
      }

      .hourly-time {
        font-size: 12px;
        color: #666;
        margin-bottom: 8px;
      }

      .hourly-temp {
        font-size: 20px;
        font-weight: bold;
        color: #667eea;
        margin: 8px 0;
      }

      .hourly-desc {
        font-size: 11px;
        color: #666;
      }

      .daily-forecast {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .daily-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .daily-day {
        font-weight: bold;
        flex: 1;
      }

      .daily-temps {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .daily-high {
        font-weight: bold;
        color: #ff6b6b;
      }

      .daily-low {
        color: #666;
      }

      .warnings {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        border-radius: 10px;
      }

      .warning-item {
        margin-bottom: 10px;
      }

      .warning-title {
        font-weight: bold;
        color: #856404;
        margin-bottom: 5px;
      }

      .warning-desc {
        font-size: 14px;
        color: #856404;
      }

      .radar-container {
        height: 400px;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
      }

      #ventusky-radar {
        width: calc(100% + (var(--radar-crop-amount) * 2));
        height: calc(100% + (var(--radar-crop-amount) * 2));
        border: none;
        position: absolute;
        top: calc(var(--radar-crop-amount) * -1);
        left: calc(var(--radar-crop-amount) * -1);
      }

      .refresh-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .refresh-btn:active {
        transform: scale(0.98);
      }

      .hidden {
        display: none;
      }

      .last-updated {
        text-align: center;
        color: white;
        font-size: 12px;
        margin-top: 10px;
        opacity: 0.8;
      }

      @media (max-width: 360px) {
        .temp-display {
          font-size: 56px;
        }

        .weather-details {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Weather App</h1>
        <div class="location-info" id="locationInfo">
          Getting your location...
        </div>
      </header>

      <div id="loadingScreen" class="loading">
        <div>üå§Ô∏è</div>
        <div>Loading weather data...</div>
      </div>

      <div id="errorScreen" class="error hidden"></div>

      <div id="mainContent" class="hidden">
        <!-- Current Weather -->
        <div class="card current-weather">
          <div class="temp-display" id="currentTemp">--¬∞</div>
          <div class="weather-description" id="weatherDesc">--</div>
          <div class="weather-details">
            <div class="detail-item">
              <div class="detail-label">Feels Like</div>
              <div class="detail-value" id="feelsLike">--¬∞</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Humidity</div>
              <div class="detail-value" id="humidity">--%</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Wind</div>
              <div class="detail-value" id="wind">-- mph</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Precipitation</div>
              <div class="detail-value" id="precipitation">-- in</div>
            </div>
          </div>
        </div>

        <!-- Weather Warnings -->
        <div id="warningsCard" class="card hidden">
          <div class="section-title">‚ö†Ô∏è Weather Alerts</div>
          <div class="warnings" id="warningsContainer"></div>
        </div>

        <!-- Hourly Forecast -->
        <div class="card">
          <div class="section-title">Hourly Forecast</div>
          <div class="hourly-forecast" id="hourlyForecast"></div>
        </div>

        <!-- Daily Forecast -->
        <div class="card">
          <div class="section-title">7-Day Forecast</div>
          <div class="daily-forecast" id="dailyForecast"></div>
        </div>

        <!-- Radar -->
        <div class="card">
          <div class="section-title">Weather Radar</div>
          <div class="radar-container">
            <iframe id="ventusky-radar" src="" allowfullscreen></iframe>
          </div>
        </div>

        <button class="refresh-btn" onclick="refreshWeather()">
          Refresh Weather
        </button>
        <div class="last-updated" id="lastUpdated"></div>
      </div>
    </div>

    <script>
      let currentLat, currentLon;

      // Initialize the app
      async function init() {
        try {
          // Get user location
          const position = await getUserLocation();
          currentLat = position.coords.latitude;
          currentLon = position.coords.longitude;

          // Get location name
          await getLocationName(currentLat, currentLon);

          // Load weather data
          await loadWeatherData();

          // Initialize Ventusky radar
          initVentuskyRadar();

          // remove unwanted parts of the Ventusky interface
          const ventuskyIframe = document.getElementById("ventusky-radar");
          // get rid of items with id "d" and id "i" in the iframe
          console.log(ventuskyIframe.contentWindow.document);
          ventuskyIframe.onload = () => {
            const ventuskyDoc = ventuskyIframe.contentWindow.document;
            const dElement = ventuskyDoc.getElementById("d");
            const iElement = ventuskyDoc.getElementById("i");
            if (dElement) dElement.style.display = "none";
            if (iElement) iElement.style.display = "none";
            console.log(
              "now it looks like this: ",
              ventuskyIframe.contentWindow.document,
            );
          };
          // Show main content
          document.getElementById("loadingScreen").classList.add("hidden");
          document.getElementById("mainContent").classList.remove("hidden");

          // Update last updated time
          updateLastUpdated();
        } catch (error) {
          showError(error.message);
        }
      }

      // Get user's location using browser's Geolocation API
      function getUserLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject(new Error("Geolocation is not supported by your browser"));
            return;
          }

          navigator.geolocation.getCurrentPosition(resolve, (error) => {
            reject(
              new Error(
                "Unable to get your location. Please enable location services.",
              ),
            );
          });
        });
      }

      // Get location name using reverse geocoding
      async function getLocationName(lat, lon) {
        try {
          const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`,
          );
          const data = await response.json();

          const city =
            data.address.city ||
            data.address.town ||
            data.address.village ||
            "Unknown Location";
          const state = data.address.state || "";
          const country = data.address.country || "";

          document.getElementById("locationInfo").textContent =
            `${city}, ${state}`;
        } catch (error) {
          document.getElementById("locationInfo").textContent =
            `${lat.toFixed(2)}, ${lon.toFixed(2)}`;
        }
      }

      // Load weather data from Open-Meteo API (free and no key required)
      async function loadWeatherData() {
        try {
          // Using Open-Meteo API for weather data (free, no key needed)
          const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${currentLat}&longitude=${currentLon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m&hourly=temperature_2m,precipitation_probability,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto`;

          const response = await fetch(weatherUrl);
          const data = await response.json();

          // Update current weather
          updateCurrentWeather(data);

          // Update hourly forecast
          updateHourlyForecast(data);

          // Update daily forecast
          updateDailyForecast(data);

          // Check for weather warnings (simplified - based on weather codes)
          checkWeatherWarnings(data);
        } catch (error) {
          throw new Error("Failed to load weather data: " + error.message);
        }
      }

      // Update current weather display
      function updateCurrentWeather(data) {
        const current = data.current;

        document.getElementById("currentTemp").textContent =
          `${Math.round(current.temperature_2m)}¬∞F`;
        document.getElementById("feelsLike").textContent =
          `${Math.round(current.apparent_temperature)}¬∞F`;
        document.getElementById("humidity").textContent =
          `${current.relative_humidity_2m}%`;
        document.getElementById("wind").textContent =
          `${Math.round(current.wind_speed_10m)} mph`;
        document.getElementById("precipitation").textContent =
          `${current.precipitation.toFixed(2)} in`;
        document.getElementById("weatherDesc").textContent =
          getWeatherDescription(current.weather_code);
      }

      // Update hourly forecast
      function updateHourlyForecast(data) {
        const hourlyContainer = document.getElementById("hourlyForecast");
        hourlyContainer.innerHTML = "";

        // Show next 24 hours
        for (let i = 0; i < 24; i++) {
          const time = new Date(data.hourly.time[i]);
          const temp = Math.round(data.hourly.temperature_2m[i]);
          const weatherCode = data.hourly.weather_code[i];
          const precipProb = data.hourly.precipitation_probability[i];

          const hourlyItem = document.createElement("div");
          hourlyItem.className = "hourly-item";
          hourlyItem.innerHTML = `
                    <div class="hourly-time">${time.getHours()}:00</div>
                    <div class="hourly-temp">${temp}¬∞F</div>
                    <div class="hourly-desc">${getWeatherEmoji(weatherCode)}</div>
                    <div class="hourly-desc">${precipProb}%</div>
                `;
          hourlyContainer.appendChild(hourlyItem);
        }
      }

      // Update daily forecast
      function updateDailyForecast(data) {
        const dailyContainer = document.getElementById("dailyForecast");
        dailyContainer.innerHTML = "";

        const days = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];

        for (let i = 0; i < 7; i++) {
          const date = new Date(data.daily.time[i]);
          const dayName = i === 0 ? "Today" : days[date.getDay()];
          const high = Math.round(data.daily.temperature_2m_max[i]);
          const low = Math.round(data.daily.temperature_2m_min[i]);
          const weatherCode = data.daily.weather_code[i];
          const precip = data.daily.precipitation_sum[i];

          const dailyItem = document.createElement("div");
          dailyItem.className = "daily-item";
          dailyItem.innerHTML = `
                    <div class="daily-day">
                        <div>${dayName}</div>
                        <div style="font-size: 12px; color: #666;">${getWeatherDescription(weatherCode)}</div>
                    </div>
                    <div style="font-size: 12px; color: #666;">${precip.toFixed(2)}" rain</div>
                    <div class="daily-temps">
                        <span class="daily-high">${high}¬∞</span>
                        <span class="daily-low">${low}¬∞</span>
                    </div>
                `;
          dailyContainer.appendChild(dailyItem);
        }
      }

      // Check for weather warnings based on weather codes
      function checkWeatherWarnings(data) {
        const warningsCard = document.getElementById("warningsCard");
        const warningsContainer = document.getElementById("warningsContainer");
        warningsContainer.innerHTML = "";

        const warnings = [];

        // Check current weather
        const currentCode = data.current.weather_code;
        if (currentCode >= 95) {
          warnings.push({
            title: "Thunderstorm Warning",
            desc: "Severe thunderstorms are occurring in your area. Stay indoors and avoid open areas.",
          });
        } else if (currentCode >= 71 && currentCode <= 77) {
          warnings.push({
            title: "Snow Warning",
            desc: "Snowfall is occurring or expected. Drive carefully and prepare for winter conditions.",
          });
        } else if (data.current.wind_speed_10m > 25) {
          warnings.push({
            title: "High Wind Advisory",
            desc: `Strong winds at ${Math.round(data.current.wind_speed_10m)} mph. Secure loose objects.`,
          });
        }

        // Check for heavy precipitation
        if (data.current.precipitation > 0.5) {
          warnings.push({
            title: "Heavy Precipitation",
            desc: "Heavy rain or snow is falling. Exercise caution when traveling.",
          });
        }

        // Display warnings
        if (warnings.length > 0) {
          warnings.forEach((warning) => {
            const warningItem = document.createElement("div");
            warningItem.className = "warning-item";
            warningItem.innerHTML = `
                        <div class="warning-title">${warning.title}</div>
                        <div class="warning-desc">${warning.desc}</div>
                    `;
            warningsContainer.appendChild(warningItem);
          });
          warningsCard.classList.remove("hidden");
        } else {
          warningsCard.classList.add("hidden");
        }
      }

      // Initialize Ventusky radar
      function initVentuskyRadar() {
        const iframe = document.getElementById("ventusky-radar");
        // Ventusky iframe URL with radar overlay
        iframe.src = `https://www.ventusky.com/?p=${currentLat};${currentLon};8&l=radar&t=20260217/00`;
      }

      // Get weather description from code
      function getWeatherDescription(code) {
        const descriptions = {
          0: "Clear sky",
          1: "Mainly clear",
          2: "Partly cloudy",
          3: "Overcast",
          45: "Foggy",
          48: "Foggy",
          51: "Light drizzle",
          53: "Drizzle",
          55: "Heavy drizzle",
          61: "Light rain",
          63: "Rain",
          65: "Heavy rain",
          71: "Light snow",
          73: "Snow",
          75: "Heavy snow",
          77: "Snow grains",
          80: "Light showers",
          81: "Showers",
          82: "Heavy showers",
          85: "Light snow showers",
          86: "Snow showers",
          95: "Thunderstorm",
          96: "Thunderstorm with hail",
          99: "Severe thunderstorm",
        };
        return descriptions[code] || "Unknown";
      }

      // Get weather emoji from code
      function getWeatherEmoji(code) {
        if (code === 0 || code === 1) return "‚òÄÔ∏è";
        if (code === 2) return "‚õÖ";
        if (code === 3) return "‚òÅÔ∏è";
        if (code >= 45 && code <= 48) return "üå´Ô∏è";
        if (code >= 51 && code <= 55) return "üå¶Ô∏è";
        if (code >= 61 && code <= 65) return "üåßÔ∏è";
        if (code >= 71 && code <= 77) return "üå®Ô∏è";
        if (code >= 80 && code <= 82) return "üåßÔ∏è";
        if (code >= 85 && code <= 86) return "üå®Ô∏è";
        if (code >= 95) return "‚õàÔ∏è";
        return "üå§Ô∏è";
      }

      // Update last updated time
      function updateLastUpdated() {
        const now = new Date();
        const timeString = now.toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
        document.getElementById("lastUpdated").textContent =
          `Last updated: ${timeString}`;
      }

      // Refresh weather data
      async function refreshWeather() {
        try {
          document.getElementById("errorScreen").classList.add("hidden");
          await loadWeatherData();
          updateLastUpdated();
        } catch (error) {
          showError("Failed to refresh weather data: " + error.message);
        }
      }

      // Show error message
      function showError(message) {
        document.getElementById("loadingScreen").classList.add("hidden");
        document.getElementById("mainContent").classList.add("hidden");
        const errorScreen = document.getElementById("errorScreen");
        errorScreen.textContent = message;
        errorScreen.classList.remove("hidden");
      }

      // Start the app when page loads
      window.addEventListener("load", init);
    </script>
  </body>
</html>
